<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Sistema Solar AR - Modular</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
      #overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); z-index: 9999;
        display: flex; flex-direction: column; justify-content: center; align-items: center;
        color: white; font-family: sans-serif;
      }
      .btn {
        padding: 15px 30px; font-size: 20px; background: #007bff; color: white;
        border: none; border-radius: 5px; cursor: pointer; margin-top: 20px;
      }
    </style>
  </head>

  <body style="margin : 0px; overflow: hidden;">

    <div id="overlay">
      <h1>Explorador Espacial</h1>
      <p>Apunta al marcador para ver el planeta</p>
      <button class="btn" onclick="iniciarExperiencia()">COMENZAR MISIÓN</button>
    </div>
<script>
      // --- CONFIGURACIÓN ---
      const planetasDB = [
        
  {
    id: 0,
    nombre: "Sol",
    pattern: "assets/marcadores/pattern_sol.patt",
    textura: "assets/planetas/sol.jpg", // ¡Falta esta imagen!
    audio: "assets/audio/sol_sonido.mp3",
    tamano: 1.2,
    velocidad: 35000 // Rotación muy lenta
  },
  // --- PLANETAS INTERIORES ---
  {
    id: 1,
    nombre: "Mercurio",
    pattern: "assets/marcadores/pattern_mercurio.patt",
    textura: "assets/planetas/2k_mercury.jpg", // Usando tu textura subida
    audio: "assets/audio/mercurio_sonido.mp3",
    tamano: 0.3,
    velocidad: 15000
  },
  {
    id: 2,
    nombre: "Venus",
    pattern: "assets/marcadores/pattern_venus.patt",
    textura: "assets/planetas/2k_venus_surface.jpg", // ¡Falta esta imagen!
    audio: "assets/audio/venus_sonido.mp3",
    tamano: 0.45,
    velocidad: 25000 // Rota muy lento (y al revés en la realidad)
  },
  {
    id: 3,
    nombre: "Tierra",
    pattern: "assets/marcadores/pattern_tierra.patt",
    textura: "assets/planetas/2k_earth_daymap.jpg", // Usando tu textura subida
    audio: "assets/audio/tierra_sonido.mp3",
    tamano: 0.5, 
    velocidad: 10000
  },
  {
    id: 4,
    nombre: "Marte",
    pattern: "assets/marcadores/pattern_marte.patt",
    textura: "assets/planetas/2k_mars.jpg", // Usando tu textura subida
    audio: "assets/audio/marte_sonido.mp3",
    tamano: 0.4, 
    velocidad: 10000
  },
  // --- GIGANTES GASEOSOS ---
  {
    id: 5,
    nombre: "Júpiter",
    pattern: "assets/marcadores/pattern_jupiter.patt",
    textura: "assets/planetas/2k_jupiter.jpg", // Usando tu textura subida
    audio: "assets/audio/jupiter_sonido.mp3",
    tamano: 1.0, 
    velocidad: 4000 // Muy rápido
  },
  {
    id: 5,
    nombre: "Saturno",
    pattern: "assets/marcadores/pattern_saturno.patt",
    textura: "assets/planetas/2k_saturn.jpg", // Usando tu textura subida
    audio: "assets/audio/saturno_sonido.mp3",
    tamano: 0.9, 
    velocidad: 4500
  },
  {
    id: 7,
    nombre: "Urano",
    pattern: "assets/marcadores/pattern_urano.patt",
    textura: "assets/planetas/urano.jpg", // ¡Falta esta imagen!
    audio: "assets/audio/urano_sonido.mp3",
    tamano: 0.7,
    velocidad: 6000
  },
  {
    id: 8,
    nombre: "Neptuno",
    pattern: "assets/marcadores/pattern_neptuno.patt",
    textura: "assets/planetas/2k_neptune.jpg", // Usando tu textura subida
    audio: "assets/audio/neptuno_sonido.mp3",
    tamano: 0.7,
    velocidad: 6000
  },
  // --- PLANETAS ENANOS (Tus texturas ficticias) ---
  {
    id: 9,
    nombre: "Ceres",
    pattern: "assets/marcadores/pattern_ceres.patt",
    textura: "assets/planetas/2k_ceres_fictional.jpg",
    audio: "assets/audio/ceres_sonido.mp3",
    tamano: 0.2,
    velocidad: 12000
  },
  {
    id: 10,
    nombre: "Eris",
    pattern: "assets/marcadores/pattern_eris.patt",
    textura: "assets/planetas/2k_eris_fictional.jpg",
    audio: "assets/audio/eris_sonido.mp3",
    tamano: 0.2,
    velocidad: 12000
  },
  {
    id: 11,
    nombre: "Haumea",
    pattern: "assets/marcadores/pattern_haumea.patt",
    textura: "assets/planetas/2k_haumea_fictional.jpg",
    audio: "assets/audio/haumea_sonido.mp3",
    tamano: 0.25, // Ligeramente más grande por ser ovalado
    velocidad: 3800 // Rota rapidísimo en la vida real (4 horas)
  },
  {
    id: 12,
    nombre: "Makemake",
    pattern: "assets/marcadores/pattern_makemake.patt",
    textura: "assets/planetas/2k_makemake_fictional.jpg",
    audio: "assets/audio/makemake_sonido.mp3",
    tamano: 0.2,
    velocidad: 12000
  }
  ,{
    id: 11,
    nombre: "luna",
    pattern: "assets/marcadores/pattern_luna.patt",
    textura: "assets/planetas/luna.jpg",
    audio: "assets/audio/luna_sonido.mp3",
    tamano: 0.25, // Ligeramente más grande por ser ovalado
    velocidad: 3800 // Rota rapidísimo en la vida real (4 horas)
  }
];

// Variable global para controlar reproducción exclusiva
      let audioActual = null;

      // --- 1. COMPONENTE DE AUDIO ---
      AFRAME.registerComponent('sound-handler', {
        init: function () {
          this.el.addEventListener('markerFound', () => {
            const soundEntity = this.el.querySelector('[sound]');
            
            if (soundEntity) {
                console.log("Planeta detectado. Intentando reproducir...");

                // Si ya está sonando este mismo, no hacer nada
                if (soundEntity.components.sound.isPlaying) return;

                // Si hay otro sonando, cállalo
                if (audioActual && audioActual !== soundEntity) {
                    audioActual.components.sound.stopSound();
                    console.log("Silenciando anterior...");
                }

                // REPRODUCIR
                // Importante: .catch() captura si el navegador lo bloquea
                try {
                    soundEntity.components.sound.playSound();
                    audioActual = soundEntity;
                    console.log("Reproduciendo AUDIO con éxito.");
                } catch (error) {
                    console.error("Error al reproducir audio:", error);
                }
            }
          });

          // Opcional: Pausar si se pierde el marcador (comenta esto si prefieres que siga hablando)
          this.el.addEventListener('markerLost', () => {
             // console.log("Marcador perdido - Audio sigue sonando (Narrador mode)");
          });
        }
      });

      // --- INICIO ---
    function iniciarExperiencia() {
        document.getElementById('overlay').style.display = 'none';
        
        const scene = document.querySelector('a-scene');
        if (scene.audioListener) {
            const context = scene.audioListener.context;
            if (context.state === 'suspended') {
                context.resume().then(() => {
                    console.log("AudioContext DESPERTADO forzosamente.");
                });
            }
        }

        planetasDB.forEach(data => {
          const marker = document.createElement('a-marker');
          
          // Configuración del marcador
          if (data.pattern === 'hiro') {
            marker.setAttribute('preset', 'hiro');
          } else {
            marker.setAttribute('type', 'pattern');
            marker.setAttribute('url', data.pattern);
          }
          
          marker.setAttribute('sound-handler', ''); // Activamos la lógica inteligente
          marker.setAttribute('emitevents', 'true');

          // Configuración del Planeta (Con la velocidad personalizada que pediste)
          const sphere = document.createElement('a-sphere');
          sphere.setAttribute('position', '0 0.5 0');
          sphere.setAttribute('radius', data.tamano);
          
          // Shader especial para el Sol
          if (data.nombre === "Sol") {
              sphere.setAttribute('material', 'shader: flat; src: ' + data.textura);
          } else {
              sphere.setAttribute('src', data.textura);
          }
          
          // Animación con velocidad personalizada
          sphere.setAttribute('animation', `property: rotation; to: 0 360 0; loop: true; dur: ${data.velocidad || 10000}; easing: linear`);

          // Configuración del Audio
          if (data.audio) {
            const sound = document.createElement('a-entity');
            
            sound.setAttribute('sound', `src: url(${data.audio}); autoplay: false; volume: 6`);
            marker.appendChild(sound);
            
          }

          marker.appendChild(sphere);
          scene.appendChild(marker);
        });
      }
    
    </script>

    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">
      <a-entity camera></a-entity>
      
    </a-scene>

  </body>
</html>
